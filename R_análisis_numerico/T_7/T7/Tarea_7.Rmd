---
title: "Tarea 7. EDOs: Sistemas y orden superior"
author: "Análisis Numérico."
date: "Mayo del 2024"
output: 
  html_document:
    toc: false
    theme: cerulean
---





<style>
body {
text-align: justify}
</style>



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(tidyverse)
library(pracma)
library(plotly)
library(lubridate)
library(polynom)
library(RColorBrewer)
library(plotly)
library(MASS)
library(car)
library(rgl)

knitr::knit_hooks$set(webgl = hook_webgl)

```



# Problema 1

Solve the initial-value problem .
1. $2y''+5y'-3y=0$, $0\leq t\leq 3$, $y(0)=1$ $y'(0)=11$. 

Solución exacta
$4e^{(t/2)}-3e^{(-3t)}$


```{r}
dy <- function(t, u){as.matrix(c(u[2], (3/2)*u[1]-(5/2)*u[2]))}
y0 <- as.matrix(c(1,11))
sol_aprox <- ode45(dy, 0, 3, y0, hmax=0.01)

y_exacta <- function(t){4*exp(t/2)-3*exp(-3*t)}

sol_rg <- ode45(dy, 0, 3, y0, hmax=0.01)

sol_sis <- ggplot()+
  geom_line(aes(sol_aprox$t, y_exacta(sol_aprox$t)), color="#ED7222", size=1.5)+
  geom_line(aes(sol_aprox$t, sol_aprox$y[ ,1]), color="#9FBC5A")+
  labs(x="t", y="y(t)")+
  theme_bw()
ggplotly(sol_sis)


```


# Problema 2

 $y''+y=-sin(2t)$, $0\leq t\leq 100$, $y(0)=0$ $y'(0)=0$.
 
 solución exacta
 $-\frac{2}{3}sin(t)+\frac{1}{3}sin(2t)$



```{r}
dy <- function(t, u){
  as.matrix(c(u[2], -sin(2*t)-u[1]))
}
y0 <- as.matrix(c(0,0))
sol_aprox <- ode45(dy, 0, 100, y0, hmax=0.01)

y_exacta <- function(t){-2/3*sin(t)+1/3*sin(2*t)}
max_y_aprox <- max(sol_aprox$y[,1])

sol_rg <- ode45(dy, 0, 100, y0, hmax=0.01)

sol_sis <- ggplot()+
  geom_line(aes(sol_aprox$t, y_exacta(sol_aprox$t)), color="#ED7222", size=1.5)+
  geom_line(aes(sol_aprox$t, sol_aprox$y[ ,1]), color="#9FBC5A")+
  labs(x="t", y="y(t)")+
  theme_bw()
ggplotly(sol_sis)
```

# Problema 3...

$196x^2y′′−56xy′+81y=0$, $0\leq t\leq 10$, $y(1)=0$ $y'(1)=1$
 solución exacta
 $x^{(9/14)}*log(|(t)|)$
 
 En este problema webwork da mal los valores iniciales ya que son 
 $y(-1)=2$ $y'(-1)=-8$ y la solucion general contiene logaritmo $At^(9/14)+Bln(x)x^(9/14)$ la cual no esta definida para valores t<=0, por tanto la cambie el PVI
 

```{r}
dy <- function(t, u){
  as.matrix(c(u[2], -81/(196*t^2)*u[1]+(56/(t*196))*u[2]))
}
y0 <- as.matrix(c(0,1))
sol_aprox <- ode45(dy, 1, 10, y0, hmax=0.01)

y_exacta <- function(t){t^(9/14)*log(abs(t))}
max_y_aprox <- max(sol_aprox$y[,1])

sol_rg <- ode45(dy, 1, 10, y0, hmax=0.01)

sol_sis <- ggplot()+
  geom_line(aes(sol_aprox$t, y_exacta(sol_aprox$t)), color="#ED7222", size=1.5)+
  geom_line(aes(sol_aprox$t, sol_aprox$y[ ,1]), color="#9FBC5A")+
  labs(x="t", y="y(t)")+
  theme_bw()
ggplotly(sol_sis)
```



# Problema 4
$y''-12y'+36y=$$\frac{e^{-6t}}{1+t^2} $$
 $0\leq t\leq 10$, $y(0)=4$ $y'(0)=-4$
 
 
```{r}
dy <- function(t, u){as.matrix(c(u[2], (-6*t)/(1 + t^2)-36*u[1]+12*u[2]))}
y0 <- as.matrix(c(4,-4))
sol_aprox <- ode45(dy, 0, 3, y0, hmax=0.01)



sol_rg <- ode45(dy, 0, 3, y0, hmax=0.01)

sol_sis <- ggplot()+
  geom_line(aes(sol_aprox$t, sol_aprox$y[ ,1]), color="#5A8BB7")+
  labs(x="t", y="y(t)")+
  theme_bw()
ggplotly(sol_sis)
```


# Problema 5...

Modelo Lokta - Volterra

El modelo presa-depredador, también conocido como el modelo Lotka-Volterra, ha sido un punto de partida para el desarrollo de nuevas técnicas y teorías matemáticas. El modelo presa-depredador se ocupa de la interacción entre dos especies, donde una de ellas (presa) tiene abundante comida y la segunda especie (depredador) tiene suministro de alimentos exclusivamente a la población de presas. Se supone también que, durante el proceso, en un intervalo de tiempo t
, el medio no debería cambiar favoreciendo a ninguna de las especies y que cualquier adaptación genética es lo suficientemente lenta.

En pocas palabras, el modelo de Lotka-Volterra supone que las presas crecen exponencialmente en ausencia de depredadores y que la tasa de mortalidad de depredadores en ausencia de presa es proporcional a su población y(t)
 en cada momento t
 (muerte por falta de alimentos) La tasa de natalidad del depredador depende exclusivamente de la cantidad de presas devoradas en cada encuentro.

Por tanto, en el modelo clásico de Lotka-Volterra se considera un hábitat en donde coexisten dos especies que interaccionan entre ellas. La especie x(t)
 se le llamará presa y tiene una fuente de alimentación por la que no compite; la otra especie y(t)
, a la que llamaremos depredador, tiene a x(t)
 en su dieta. De esta forma, x(t)
 representa el número de presas en el instante t
, mientras que y(t)
 indica la cantidad de depredadores en ese mismo momento.


## Ejemplo de modelo Lokta - Volterra

Se define una función LVmod que representa el sistema de ecuaciones diferenciales que describen la dinámica de las poblaciones de presa y depredador. Esta función toma tres argumentos: Time (tiempo), State (estado inicial de las poblaciones) y Pars (parámetros del modelo).

```{r}
library(deSolve)   #PVI,ESD,EDP y EDO
LVmod <- function(Time, State, Pars) {
  with(as.list(c(State, Pars)), {
    Ingestion    <- rIng  * Prey * Predator
    GrowthPrey   <- rGrow * Prey * (1 - Prey/K)
    MortPredator <- rMort * Predator
    
    dPrey        <- GrowthPrey - Ingestion
    dPredator    <- Ingestion * assEff - MortPredator
    
    return(list(c(dPrey, dPredator)))
  })
}
```


## Parámetros y condiciones iniciales

Se definen los parámetros del modelo (pars) y las condiciones iniciales (yini). Se especifica un vector de tiempos (times) para la simulación. Se realiza la simulación de las ecuaciones diferenciales usando la función ode del paquete deSolve. Los resultados se almacenan en el objeto out para luegto realizar un resumen de los resultados (summary(out)).

```{r}
pars  <- c(rIng   = 0.2,    # /day, rate of ingestion
           rGrow  = 1.0,    # /day, growth rate of prey
           rMort  = 0.2 ,   # /day, mortality rate of predator
           assEff = 0.5,    # -, assimilation efficiency
           K      = 10)     # mmol/m3, carrying capacity

yini  <- c(Prey = 1, Predator = 2)
times <- seq(0, 200, by = 1)
out   <- ode(yini, times, LVmod, pars)
summary(out)
```

## Gráficos

```{r}
## Default plot method
plot(out)
```

```{r}
## User specified plotting
matplot(out[ , 1], out[ , 2:3], type = "l", xlab = "time", ylab = "Conc",
        main = "Lotka-Volterra", lwd = 2)
legend("topright", c("prey", "predator"), col = 1:2, lty = 1:2)
```



In Example 1 we used Lotka-Volterra equations to model populations of rabbits and wolves. Let's modify those equations as follows:

$\frac{dR}{dt}=0.08R(1-0.0005R)-0.001RW$

$\frac{dR}{dt}=-0.02W+0.00003RW$

Find all of the equilibrium solutions.
Enter your answer as a list of ordered pairs (R,W)
, where R
 is the number of rabbits and W
 the number of wolves. For example, if you found three equilibrium solutions, one with 100 rabbits and 10 wolves, one with 200 rabbits and 20 wolves, and one with 300 rabbits and 30 wolves, you would enter (100,10),(200,20),(300,30)
.Do not round fractional answers to the nearest integer.



```{r}
f<-function(t,u){
  as.matrix(c(0.08*u[1]*(1-0.0005*u[1])-0.001*u[1]*u[2],-0.02*u[2]+0.00003*u[1]*u[2]))
}

u0<-as.matrix(c(200,20))

aprox_sol<-ode45(f, 0, 1800, u0)

graf<-ggplot()+
  geom_line(aes(aprox_sol$t, aprox_sol$y[ , 1]), color="firebrick")+
  geom_line(aes(aprox_sol$t, aprox_sol$y[ , 2]), color="blue")+
  labs(x="t", y="y(t)")+
  theme_bw()

ggplotly(graf)

```

# Problema 6
Find the solution to the linear system of differential equations
\begin{equation}
\begin{aligned}
x'&=-7x-3y\qquad x(0)&=0\\
y'&=6x+2y\qquad y(0)&=1;\\

\end{aligned}
\end{equation}



```{r}

dy <- function(t, u) {
  as.matrix(c(-7*u[1]-3*u[2],6*u[1]+2*u[2]))
}

u0<-as.matrix(c(0,1))

aprox_sol<-ode45(dy, 0, 10, u0, hmax = 0.01)

graf<-ggplot()+
  geom_line(aes(aprox_sol$t, aprox_sol$y[ , 1]), color="firebrick")+
  geom_line(aes(aprox_sol$t, aprox_sol$y[ , 2]), color="blue")+
  labs(x="t", y="y(t)")+
  theme_bw()

ggplotly(graf)


```



# Problema 7

David opens a bank account with an initial balance of 1500 dollars. Let b(t)
 be the balance in the account at time t
. Thus b(0)=1500
. The bank is paying interest at a continuous rate of 6% per year. David makes deposits into the account at a continuous rate of s(t)
 dollars per year. Suppose that s(0)=500
 and that s(t)
 is increasing at a continuous rate of 5% per year (David can save more as his income goes up over time).

(a) Set up a linear system of the form

$\frac{db}{dt}=m_11b + m_12s$

$\frac{ds}{dt}=m_21b+m_22s$

```{r}
dy <- function(t, u) {
  as.matrix(c(0.06*u[1]+u[2], 0.05*u[2]))
}

u0<-as.matrix(c(0,2))

aprox_sol<-ode45(dy, 0, 40, u0, hmax = 0.01)

graf<-ggplot()+
  geom_line(aes(aprox_sol$t, aprox_sol$y[ , 1]), color="firebrick")+
  geom_line(aes(aprox_sol$t, aprox_sol$y[ , 2]), color="blue")+
  labs(x="t", y="y(t)")+
  theme_bw()

ggplotly(graf)
```

# Problema 8...

$y''-6y'+4.5y=-7.5sin(3t) $$
 $0\leq t\leq 10$, $y(1)=-8$ $y'(1)=-6.5$

```{r}
dy <- function(t, u) {
  as.matrix(c(u[2], -7.5*sin(3*t) - 4.5*u[1] + 6*u[2]))
}

y0 <- as.matrix(c(-8, -6.5))

sol_aprox <- ode45(dy, 0,3, y0, hmax = 0.01)


sol_sis <- ggplot()+
  geom_line(aes(sol_aprox$t, sol_aprox$y[ ,1]), color="#5A8BB7")+
  labs(x="t", y="y(t)")+
  theme_bw()
ggplotly(sol_sis)
```

# Problema 9

\begin{equation}
\begin{aligned}
y'_1&=-7y_1+3y_2-y_3-1-3t-2\, sen\,t, &\qquad y_1(0)&=5;\\
y'_2&=y_1-2y_2+3y_3+6-t+2\,sen\,t+cos\, t, &\qquad y_2(0)&=-9;\\
y'_3&=2y_1+4y_3+8-2t, &\qquad y_3(0)&=-5;
\end{aligned}
\end{equation}

para $0\leq t \leq 2$. Donde las soluciones exactas son:


\begin{equation}
\begin{aligned}
y_1(t)&=2e^{3t}+3e^{-2t}+t\\
y_2(t)&=-8e^{-2t}+e^{4t}-2e^{3t}+\,sen\,t\\
y_3(t)&=2e^{4t}-4e^{3t}-e^{-2t}-2
\end{aligned}
\end{equation}


```{r}
func <- function(t, y, parms) {
  with(as.list(c(y, parms)), {
    dy1 = -7*y[1] + 3*y[2]
    dy2 = -2*y[1] - 2*y[2]
    return(list(c(dy1, dy2)))
  })
}

parms <- c()
y0 <- c(y1 = -1, y2 = 0)
times <- seq(0, 10, by = 0.1)


out <- lsoda(y = y0, times = times, func = func, parms = parms)

plot(out[, "time"], out[, "y1"], type = "l", xlab = "Tiempo", ylab = "Valor", main = "Solución del sistema de ecuaciones diferenciales", col = "blue")
lines(out[, "time"], out[, "y2"], col = "red")
legend("topright", legend = c("y1", "y2"), col = c("blue", "red"), lty = 1)
```








