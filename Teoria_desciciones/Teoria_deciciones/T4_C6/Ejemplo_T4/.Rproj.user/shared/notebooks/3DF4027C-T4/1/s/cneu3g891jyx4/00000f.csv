"0","model3.1 <- mlogit(depvar ~ ic + oc|agehed, Heating, shape = ""wide"", choice = ""depvar"", reflevel = ""er"", varying = c(3:12))"
"0","summary(model3)"
"1","
Call:
"
"1","mlogit(formula = depvar ~ ic + oc, data = Heating, reflevel = ""ec"", 
"
"1","    shape = ""wide"", choice = ""depvar"", varying = c(3:12), method = ""nr"")
"
"1","
"
"1","Frequencies of alternatives:"
"1","choice
"
"1","      ec "
"1","      er "
"1","      gc "
"1","      gr "
"1","      hp "
"1","
"
"1","0.071111 "
"1","0.093333 "
"1","0.636667 "
"1","0.143333 "
"1","0.055556 "
"1","
"
"1","
"
"1","nr method
"
"1","6 iterations, 0h:0m:0s 
"
"1","g'(-H)^-1g = 9.58E-06 
"
"1","successive function values within tolerance limits 
"
"1","
Coefficients :
"
"1","              "
"1","    Estimate"
"1","  Std. Error"
"1"," z-value"
"1","  Pr(>|z|)"
"1","    "
"1","
(Intercept):er"
"1","  0.19459102"
"1","  0.20424212"
"1","  0.9527"
"1"," 0.3407184"
"1","    "
"1","
(Intercept):gc"
"1","  0.05213336"
"1","  0.46598878"
"1","  0.1119"
"1"," 0.9109210"
"1","    "
"1","
(Intercept):gr"
"1"," -1.35058266"
"1","  0.50715442"
"1"," -2.6631"
"1"," 0.0077434"
"1"," ** "
"1","
(Intercept):hp"
"1"," -1.65884594"
"1","  0.44841936"
"1"," -3.6993"
"1"," 0.0002162"
"1"," ***"
"1","
ic            "
"1"," -0.00153315"
"1","  0.00062086"
"1"," -2.4694"
"1"," 0.0135333"
"1"," *  "
"1","
oc            "
"1"," -0.00699637"
"1","  0.00155408"
"1"," -4.5019"
"1"," 6.734e-06"
"1"," ***"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
"
"1","Log-Likelihood: -1008.2
"
"1","McFadden R^2: "
"1"," "
"1","0.013691"
"1"," "
"1","
"
"1","Likelihood ratio test : "
"1",""
"1","chisq"
"1",""
"1"," = "
"1",""
"1","27.99"
"1",""
"1"," (p.value = "
"1",""
"1","8.3572e-07"
"1",""
"1",")
"
"0","model3.1_Long <- mlogit(depvar~ic+oc|agehed, H, reflevel = ""er"")"
"0","summary(model3_Long)"
"1","
Call:
"
"1","mlogit(formula = depvar ~ ic + oc, data = H, reflevel = ""ec"", 
"
"1","    method = ""nr"")
"
"1","
"
"1","Frequencies of alternatives:"
"1","choice
"
"1","      ec "
"1","      er "
"1","      gc "
"1","      gr "
"1","      hp "
"1","
"
"1","0.071111 "
"1","0.093333 "
"1","0.636667 "
"1","0.143333 "
"1","0.055556 "
"1","
"
"1","
"
"1","nr method
"
"1","6 iterations, 0h:0m:0s 
"
"1","g'(-H)^-1g = 9.58E-06 
"
"1","successive function values within tolerance limits 
"
"1","
Coefficients :
"
"1","              "
"1","    Estimate"
"1","  Std. Error"
"1"," z-value"
"1","  Pr(>|z|)"
"1","    "
"1","
(Intercept):er"
"1","  0.19459102"
"1","  0.20424212"
"1","  0.9527"
"1"," 0.3407184"
"1","    "
"1","
(Intercept):gc"
"1","  0.05213336"
"1","  0.46598878"
"1","  0.1119"
"1"," 0.9109210"
"1","    "
"1","
(Intercept):gr"
"1"," -1.35058266"
"1","  0.50715442"
"1"," -2.6631"
"1"," 0.0077434"
"1"," ** "
"1","
(Intercept):hp"
"1"," -1.65884594"
"1","  0.44841936"
"1"," -3.6993"
"1"," 0.0002162"
"1"," ***"
"1","
ic            "
"1"," -0.00153315"
"1","  0.00062086"
"1"," -2.4694"
"1"," 0.0135333"
"1"," *  "
"1","
oc            "
"1"," -0.00699637"
"1","  0.00155408"
"1"," -4.5019"
"1"," 6.734e-06"
"1"," ***"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
"
"1","Log-Likelihood: -1008.2
"
"1","McFadden R^2: "
"1"," "
"1","0.013691"
"1"," "
"1","
"
"1","Likelihood ratio test : "
"1",""
"1","chisq"
"1",""
"1"," = "
"1",""
"1","27.99"
"1",""
"1"," (p.value = "
"1",""
"1","8.3572e-07"
"1",""
"1",")
"
"0","#Para simular esta situación, comenzamos creando una matriz modelo basada en la salida del Modelo 3:"
"0","X <- model.matrix(model3.1)"
"0","head(X)"
"1"," "
"1"," (Intercept):ec"
"1"," (Intercept):gc"
"1"," (Intercept):gr"
"1"," (Intercept):hp"
"1","      ic"
"1","     oc"
"1"," agehed:ec"
"1"," agehed:gc"
"1"," agehed:gr"
"1"," agehed:hp"
"1","
1"
"1","              1"
"1","              0"
"1","              0"
"1","              0"
"1","  859.90"
"1"," 553.34"
"1","        25"
"1","         0"
"1","         0"
"1","         0"
"1","
2"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1","  995.76"
"1"," 505.60"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
3"
"1","              0"
"1","              1"
"1","              0"
"1","              0"
"1","  866.00"
"1"," 199.69"
"1","         0"
"1","        25"
"1","         0"
"1","         0"
"1","
4"
"1","              0"
"1","              0"
"1","              1"
"1","              0"
"1","  962.64"
"1"," 151.72"
"1","         0"
"1","         0"
"1","        25"
"1","         0"
"1","
5"
"1","              0"
"1","              0"
"1","              0"
"1","              1"
"1"," 1135.50"
"1"," 237.88"
"1","         0"
"1","         0"
"1","         0"
"1","        25"
"1","
6"
"1","              1"
"1","              0"
"1","              0"
"1","              0"
"1","  796.82"
"1"," 520.24"
"1","        60"
"1","         0"
"1","         0"
"1","         0"
"1","
"
"0","#Después, creamos una nueva alternativa copiando los atributos de electric room. En otras palabras, creamos una nueva matriz en la cual sólo se conservan las filas asociadas a electric room:"
"0","alt <- index(H)$alt"
"0","Xn <- X[alt==""er"", ]"
"0","head(Xn)"
"1","  "
"1"," (Intercept):ec"
"1"," (Intercept):gc"
"1"," (Intercept):gr"
"1"," (Intercept):hp"
"1","     ic"
"1","     oc"
"1"," agehed:ec"
"1"," agehed:gc"
"1"," agehed:gr"
"1"," agehed:hp"
"1","
2 "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 995.76"
"1"," 505.60"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
7 "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 894.69"
"1"," 486.49"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
12"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 900.11"
"1"," 404.74"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
17"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 831.04"
"1"," 425.22"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
22"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 985.64"
"1"," 389.52"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
27"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 862.56"
"1"," 371.04"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
"
"0","#A continuación se modifican los atributos para el nuevo sistema (+200 en ic y 0.75 de oc):"
"0","Xn[, ""ic""] <-  Xn[, ""ic""] + 200"
"0","Xn[, ""oc""] <-  Xn[, ""oc""] * 0.75"
"0","head(Xn)"
"1","  "
"1"," (Intercept):ec"
"1"," (Intercept):gc"
"1"," (Intercept):gr"
"1"," (Intercept):hp"
"1","      ic"
"1","       oc"
"1"," agehed:ec"
"1"," agehed:gc"
"1"," agehed:gr"
"1"," agehed:hp"
"1","
2 "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1195.76"
"1"," 379.2000"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
7 "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1094.69"
"1"," 364.8675"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
12"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1100.11"
"1"," 303.5550"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
17"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1031.04"
"1"," 318.9150"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
22"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1185.64"
"1"," 292.1400"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
27"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1062.56"
"1"," 278.2800"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
"
"0","#También queremos identificar los id’s de elección únicos (en otras palabras, los identificadores únicos que combinan el número de hogar y el tipo de sistema de calefacción), que agregaremos como nombres de fila al nuevo sistema."
"0","chid <- index(H)$chid"
"0","head(chid, 12)"
"1"," [1]"
"1"," 1"
"1"," 1"
"1"," 1"
"1"," 1"
"1"," 1"
"1"," 2"
"1"," 2"
"1"," 2"
"1"," 2"
"1"," 2"
"1"," 3"
"1"," 3"
"1","
"
"0","unchid <- unique(index(H)$chid)"
"0","head(unchid, 12)"
"1"," [1]"
"1","  1"
"1","  2"
"1","  3"
"1","  4"
"1","  5"
"1","  6"
"1","  7"
"1","  8"
"1","  9"
"1"," 10"
"1"," 11"
"1"," 12"
"1","
"
"0","rownames(Xn) <- paste(unchid, 'new', sep = ""."")"
"0","chidb <- c(chid, unchid)"
"0","head(Xn)"
"1","     "
"1"," (Intercept):ec"
"1"," (Intercept):gc"
"1"," (Intercept):gr"
"1"," (Intercept):hp"
"1","      ic"
"1","       oc"
"1"," agehed:ec"
"1"," agehed:gc"
"1"," agehed:gr"
"1"," agehed:hp"
"1","
1.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1195.76"
"1"," 379.2000"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
2.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1094.69"
"1"," 364.8675"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
3.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1100.11"
"1"," 303.5550"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
4.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1031.04"
"1"," 318.9150"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
5.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1185.64"
"1"," 292.1400"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
6.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1062.56"
"1"," 278.2800"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
"
"0","#Después, podemos unir el nuevo sistema a la matriz del modelo y ordernar por id de elección:"
"0","X <- rbind(X, Xn)"
"0","X <- X[order(chidb), ]"
"0","head(X,15)"
"1","     "
"1"," (Intercept):ec"
"1"," (Intercept):gc"
"1"," (Intercept):gr"
"1"," (Intercept):hp"
"1","      ic"
"1","       oc"
"1"," agehed:ec"
"1"," agehed:gc"
"1"," agehed:gr"
"1"," agehed:hp"
"1","
1    "
"1","              1"
"1","              0"
"1","              0"
"1","              0"
"1","  859.90"
"1"," 553.3400"
"1","        25"
"1","         0"
"1","         0"
"1","         0"
"1","
2    "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1","  995.76"
"1"," 505.6000"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
3    "
"1","              0"
"1","              1"
"1","              0"
"1","              0"
"1","  866.00"
"1"," 199.6900"
"1","         0"
"1","        25"
"1","         0"
"1","         0"
"1","
4    "
"1","              0"
"1","              0"
"1","              1"
"1","              0"
"1","  962.64"
"1"," 151.7200"
"1","         0"
"1","         0"
"1","        25"
"1","         0"
"1","
5    "
"1","              0"
"1","              0"
"1","              0"
"1","              1"
"1"," 1135.50"
"1"," 237.8800"
"1","         0"
"1","         0"
"1","         0"
"1","        25"
"1","
1.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1195.76"
"1"," 379.2000"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
6    "
"1","              1"
"1","              0"
"1","              0"
"1","              0"
"1","  796.82"
"1"," 520.2400"
"1","        60"
"1","         0"
"1","         0"
"1","         0"
"1","
7    "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1","  894.69"
"1"," 486.4900"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
8    "
"1","              0"
"1","              1"
"1","              0"
"1","              0"
"1","  727.93"
"1"," 168.6600"
"1","         0"
"1","        60"
"1","         0"
"1","         0"
"1","
9    "
"1","              0"
"1","              0"
"1","              1"
"1","              0"
"1","  758.89"
"1"," 168.6600"
"1","         0"
"1","         0"
"1","        60"
"1","         0"
"1","
10   "
"1","              0"
"1","              0"
"1","              0"
"1","              1"
"1","  968.90"
"1"," 199.1900"
"1","         0"
"1","         0"
"1","         0"
"1","        60"
"1","
2.new"
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1"," 1094.69"
"1"," 364.8675"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
11   "
"1","              1"
"1","              0"
"1","              0"
"1","              0"
"1","  719.86"
"1"," 439.0600"
"1","        65"
"1","         0"
"1","         0"
"1","         0"
"1","
12   "
"1","              0"
"1","              0"
"1","              0"
"1","              0"
"1","  900.11"
"1"," 404.7400"
"1","         0"
"1","         0"
"1","         0"
"1","         0"
"1","
13   "
"1","              0"
"1","              1"
"1","              0"
"1","              0"
"1","  599.48"
"1"," 165.5800"
"1","         0"
"1","        65"
"1","         0"
"1","         0"
"1","
"
"0","#La función predict sólo acepta en el conjunto de datos las alternativas originales y no contempla una nueva alternativa. Por esta razón es necesario calcular las probabilidades paso a paso. El siguiente chunk calcula la expresión y la suma, las cuales son necesarias para calcular las probabilidades logit:"
"0",""
"0","exp_Xb <- as.numeric(exp(X %*% coef(model3.1))) # vectors"
"0","head(exp_Xb)"
"1","[1]"
"1"," 0.002986060"
"1"," 0.006252460"
"1"," 0.040268913"
"1"," 0.011118245"
"1"," 0.004723184"
"1"," 0.011211263"
"1","
"
"0","# tapply does the sum of th exp_Xb for each chidb"
"0","sum_exp_Xb <- as.numeric(tapply(exp_Xb, sort(chidb), sum))"
"0",""
"0","#Este es el vector de probabilidades logit:"
"0","P <- exp_Xb / sum_exp_Xb[sort(chidb)]"
"0",""
"0","#Ahora lo convertimos a una matriz de probabilidades logit, tal que cada fila sea la probabilidad de elección de un hogar:"
"0",""
"0","P <- data.frame(matrix(P, ncol = 6, byrow = TRUE))"
"0","P <- transmute(P, ec = P[, 1], er = P[, 2], gc = P[, 3], gr = P[, 4], hp = P[, 5], new = P[, 6])"
"0",""
"0","#Podemos verificar que la suma de las probabilidades para cada fila es 1:"
"0","summary(rowSums(P))"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","      1 "
"1","      1 "
"1","      1 "
"1","      1 "
"1","      1 "
"1","      1 "
"1","
"
"0","#La aceptación estimada del nuevo sistema es el promedio de las probabilidades obtenidas:"
"0",""
"0","apply(P, 2, mean)"
"1","        ec "
"1","        er "
"1","        gc "
"1","        gr "
"1","        hp "
"1","       new "
"1","
"
"1","0.06240038 "
"1","0.08028965 "
"1","0.55994278 "
"1","0.12608392 "
"1","0.04844228 "
"1","0.12284100 "
"1","
"
"0","#Se estima que la nueva tecnología tenga una aceptación de aproximadamente el Si comparamos estas tasas de aceptación estimadas con las cuotas de mercado originales de los sistemas, tenemos:"
"0",""
"0","apply(fitted(model3.1, outcome = FALSE), 2, mean)"
"1","        er "
"1","        ec "
"1","        gc "
"1","        gr "
"1","        hp "
"1","
"
"1","0.09333333 "
"1","0.07111111 "
"1","0.63666667 "
"1","0.14333333 "
"1","0.05555556 "
"1","
"
